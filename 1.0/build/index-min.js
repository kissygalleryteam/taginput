/*!build time : 2014-05-07 2:31:21 PM*/
KISSY.add("gallery/taginput/1.0/index",function(a,b,c){"use strict";function d(a){d.superclass.constructor.call(this,a),this.init()}var e=b.all;return a.extend(d,c,{init:function(){this.con=e(this.get("container")),this.tags=[],this.render()},render:function(){this.renderUI(),this.bindUI(),this.syncUI()},renderUI:function(){this.con.addClass("taginput"),this._renderInput()},bindUI:function(){this.get("editable")&&(this._bindInputEvents(),this._bindTagDelete()),this._bindCustomEvents()},syncUI:function(){},_renderInput:function(){this.inputWrap=e('<div id="J_tagInput_addWrap" class="input-wrap"></div>').appendTo(this.con),this.con.css({width:this.get("width"),"min-height":this.get("height"),height:"100%"}),this.get("editable")&&(this.inputNode=e('<input id="J_textInput" autocomplete="off" type="text" value="" data-placeholder="'+this.get("placeholder")+'"/>').appendTo(this.inputWrap),this.inputNode.val(this.inputNode.attr("data-placeholder"))),this.importTags(this.get("defaultTags"))},_isTagExist:function(b){return a.inArray(b,this.tags)},_bindInputEvents:function(){this.con.on("click",this._onConClick,this),this.inputNode.on("focus",this._onInputFocus,this),this.inputNode.on("blur",this._onInputBlur,this),this.inputNode.on("keypress",this._onKeyPress,this),this.inputNode.on("keydown",this._onKeyDown,this)},_onConClick:function(){this.inputNode.getDOMNode().focus()},_onInputFocus:function(){var b=this.inputNode;b.attr("data-placeholder")===a.trim(b.val())&&b.val("")},_onInputBlur:function(){var b=this.inputNode,c=b.attr("data-placeholder"),d=a.trim(b.val());""!==d&&d!==c&&d.length>=this.get("minChar")&&d.length<=this.get("maxChar")||b.val(b.attr("data-placeholder"))},_onKeyPress:function(a){if(13===a.keyCode||44===a.keyCode){a.halt();var b=this.inputNode.val(),c=this.inputNode.attr("data-placeholder");""!==b&&b!==c&&b.length>=this.get("minChar")&&b.length<=this.get("maxChar")&&this.addTag(b)}},_onKeyDown:function(a){if(this.get("canDeleteByKey")&&8===a.keyCode&&""===this.inputNode.val()){a.halt();var b=this.tags[this.tags.length-1];this.removeTag(b)}(8===a.keyCode||String.fromCharCode(a.which).match(/\w+|[\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1,]+/))&&this.inputNode.removeClass("not-valid")},_bindTagDelete:function(){this.con.delegate("click",".delete-btn",this._onClickDelete,this)},_onClickDelete:function(a){a.halt();var b=e(a.currentTarget).parent(".tag").attr("data-name");this.removeTag(b)},_bindCustomEvents:function(){this.on("event:addTag",this._onAddTag,this),this.on("event:removeTag",this._onRemoveTag,this)},_onAddTag:function(b){var c=this.get("onTagAdd");this.inputNode.val(""),this.inputNode.removeClass("not-valid"),c&&a.isFunction(c)&&c.call(this,b.tag)},_onRemoveTag:function(b){var c=this.get("onTagRemove");c&&a.isFunction(c)&&c.call(this,b.tag)},importTags:function(b){var c=this;this.con.all(".tag").remove(),this.tags=[],a.each(b,function(a){c.addTag(a)})},addTag:function(b){b=a.trim(b);var c=this._isTagExist(b);if(c&&this.inputNode&&this.inputNode.addClass("not-valid"),""!==b&&!c){var d='<span class="tag" data-name="{tag}"><span>{tag}</span><a class="delete-btn" href="javascript:void(0);" style="display:{display}">x</a></span>';e(a.substitute(d,{tag:b,display:this.get("editable")?"inline-block":"none"})).insertBefore(this.inputWrap),this.tags.push(b),this.fire("event:addTag",{tag:b})}},removeTag:function(b){b=a.trim(b);var c=this._isTagExist(b),d=this;c&&(a.each(this.con.all(".tag"),function(a){return a=e(a),a.attr("data-name")===b?(a.remove(),!1):void 0}),a.each(this.tags,function(a,c){return b===a?(d.tags.splice(c,1),!1):void 0}),this.fire("event:removeTag",{tag:b}))},getInputWrap:function(){return this.inputWrap}},{ATTRS:{container:{value:"#J_tagInput"},defaultTags:{value:[]},editable:{value:!0},height:{value:"100px"},width:{value:"300px"},placeholder:{value:"\u8bf7\u6dfb\u52a0\u6807\u7b7e"},minChar:{value:0},maxChar:{value:20},onTagAdd:{value:a.noop},onTagRemove:{value:a.noop},canDeleteByKey:{value:!0}}}),d},{requires:["node","base","./index.css"]});